<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Leads</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
 <!-- Add necessary meta tags and links to CSS/JS files -->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css">

<!-- DataTables JavaScript -->
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>

<!-- DataTables Buttons CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.0.1/css/buttons.dataTables.css">

<!-- DataTables Buttons JavaScript -->
<script src="https://cdn.datatables.net/buttons/3.0.1/js/dataTables.buttons.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.1/js/buttons.dataTables.js"></script>

<!-- JSZip -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- pdfmake -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<!-- DataTables Buttons HTML5 and Print JavaScript -->
<script src="https://cdn.datatables.net/buttons/3.0.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.1/js/buttons.print.min.js"></script>

<!-- DataTables Select JavaScript -->
<script src="https://cdn.datatables.net/select/2.0.0/js/dataTables.select.js"></script>
<script src="https://cdn.datatables.net/select/2.0.0/js/select.dataTables.js"></script>

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
     <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap');
body {
    color: #000 !important; /* Ensure all text is black */
}

select {
    color: #000 !important; /* Ensure select text is black */
}

{{!-- ::placeholder {
    color: #000 !important; /* Ensure placeholder text is black */
}

:-ms-input-placeholder { /* Internet Explorer 10-11 */
    color: #000 !important;
} --}}

::-ms-input-placeholder { /* Microsoft Edge */
    color: #000 !important;
}


/* CSS */
.button-57 {
  position: relative;
  overflow: hidden;
  border: 1px solid #18181a;
  color: #18181a;
  display: inline-block;
  font-size: 15px;
  line-height: 15px;
  border-radius: 7px;
  padding: 12px 12px 11px;
  text-decoration: none;
  cursor: pointer;
  background: #fff;
  user-select: none;
  margin-bottom: ;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-57 span:first-child {
  position: relative;
  transition: color 600ms cubic-bezier(0.48, 0, 0.12, 1);
  z-index: 10;
}

.button-57 span:last-child {
  color: white;
  display: block;
  position: absolute;
  bottom: 0;
  transition: all 500ms cubic-bezier(0.48, 0, 0.12, 1);
  z-index: 100;
  opacity: 0;
  top: 50%;
  left: 50%;
  transform: translateY(225%) translateX(-50%);
  height: 14px;
  line-height: 13px;
}

.button-57:after {
  content: "";
  position: absolute;
  bottom: -50%;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: black;
  transform-origin: bottom center;
  transition: transform 600ms cubic-bezier(0.48, 0, 0.12, 1);
  transform: skewY(9.3deg) scaleY(0);
  z-index: 50;
}

.button-57:hover:after {
  transform-origin: bottom center;
  transform: skewY(9.3deg) scaleY(2);
}

.button-57:hover span:last-child {
  transform: translateX(-50%) translateY(-100%);
  opacity: 1;
  transition: all 900ms cubic-bezier(0.48, 0, 0.12, 1);
}
/* Define transition for hiding/showing fields and header */
.hide-fields {
  display: none;
  opacity: 0;
  transition: opacity 0.5s ease, display 0s ease 0.5s;
}

.show-fields {
  display: table-cell;
  opacity: 1;
  transition: opacity 0.5s ease;
}

.hide-header {
  display: none;
}

.show-header {
  display: table-header-group;
}
 .hide {
            display: none;
        }
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        .fade-in {
            opacity: 1;
            transition: opacity 0.5s ease-in;
        }
        .amt{
            width: 100px !important;
            font-size: 12px;
        }
         .amts{
            width: 150px !important;
            font-size: 12px;
        }

.search{
  
  top:6px;
  left:10px;
}

.form-control{
    
    border:none;
    padding-left:32px;
}
.tt {
    margin-top: 20px;
    padding: 70px;
    border-radius: 10px;background-color: #f2f9f6; /* Very pale mint green */

}
.btn-primary{
    font-size: 10px;
    background-color: #007bff !important;
}
select,textarea{
       font-size: 13px !important;
}
.table-responsive{
    padding: 10px;
}
.form-control:focus{
    
    border:none;
    box-shadow:none;
}

.green{
    
    color:green;
}
/* Button styles */
.btn-status {
    font-size: 10px; /* Smaller font size for buttons */
    padding: 4px 8px; /* Smaller padding for buttons */
    transition: background-color 0.3s ease;
}

.btn-not-paid {
    background-color: #e8172c; /* Red */
    color: #fff;
}

.btn-paid {
    background-color: #28a745; /* Green */
    color: #fff;
}

.btn-not-approved {
    background-color: #ffc107; /* Yellow */
    color: #000;
}

.btn-approved {
    background-color: #17a2b8; /* Teal */
    color: #fff;
}

.btn-not-done {
    background-color: #ffc107; /* Yellow */
    color: #000;
}

.btn-done {
    background-color: #28a745; /* Green */
    color: #fff;
}

.btn-status.active-paid {
    background-color: #28a745 !important; /* Green */
    color: #fff;
}

.btn-status.active-not-paid {
    background-color: #dc3545 !important; /* Red */
    color: #fff;
}

.btn-status.active-not-approved {
    background-color: #ffc107 !important; /* Yellow */
    color: #000;
}
/* Container for table */
.table-wrapper {
    position: relative; /* To contain the sticky header */
    overflow: auto; /* Allows the table body to scroll */
    height: 400px; /* Set a height for the scrolling area */
}

/* Ensure the table takes the full width of its container */
.table {
    width: 100%;
    border-collapse: collapse;
    font-size: 10px; /* Smaller font size for table content */
    table-layout: fixed; /* Ensures fixed widths are respected */
}

/* Ensure the table header stays fixed at the top */
.table thead {
    position: sticky;
    top: 0;
    background-color: #fff; /* Solid background color for visibility */
    z-index: 2; /* Ensure it stays on top of other content */
}

/* Table header and cells styling */
.table thead th,
.table tbody td {
    text-align: left;
    padding: 6px; /* Reduced padding for a smaller appearance */
    border: 1px solid #dee2e6;
    font-size: 12px; /* Consistent smaller font size */
    width: 120px; /* Fixed width for consistency */
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden; /* Prevent overflow for fixed-width cells */
    text-overflow: ellipsis; /* Add ellipsis for overflowed text */
    white-space: nowrap; /* Prevent text wrapping */
}

.table thead th {
    background-color: #232f65;
    color: #ffffff;
}

.table tbody tr:hover {
    background-color: #d0e3ff; /* Hover color for rows */
}
/* Adjust other table-related styles if necessary */


.btn-status.active-approved {
    background-color: #17a2b8 !important; /* Teal */
    color: #fff;
}

.btn-status.active-not-done {
    background-color: #ffc107 !important; /* Yellow */
    color: #000;
}

.btn-status.active-done {
    background-color: #28a745 !important; /* Green */
    color: #fff;
}
/* DataTables styles */
.dataTables_wrapper .dataTables_filter {
    float: right;
    text-align: right;
    margin-bottom: 10px; /* Add margin below the search bar */
}

.dataTables_wrapper .dataTables_filter input {
    margin-left: 0.5em;
    display: inline-block;
    width: auto;
    margin-bottom: 10px; /* Add margin below the search bar */
        position: sticky !important;
}

.dataTables_wrapper .dataTables_length {
    float: left;
    margin-bottom: 10px; /* Add margin below the length dropdown */
}

.dataTables_wrapper .dataTables_info {
    float: left;
    margin-top: 10px; /* Add margin above the info text */
}

.dataTables_wrapper .dataTables_paginate {
    float: right;
    margin-top: 10px; /* Add margin above the pagination controls */

}
.btn-glass:hover{
    background-color: #007bff !important;
}
    #dataTable {
    table-layout: auto;
    width: 50px !important;
}

#dataTable th, #dataTable td {
    white-space: nowrap;
    padding: 8px 12px; /* Adjust padding as needed */
}
.animated-btn {
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease-in-out;
}

.animated-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 300%;
    height: 300%;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 80%);
    transition: transform 0.3s ease-in-out;
    transform: translate(-50%, -50%) scale(0);
    z-index: 0;
}

.animated-btn:hover::before {
    transform: translate(-50%, -50%) scale(1);
}

.animated-btn:hover {
    transform: scale(1.05);
}

.animated-btn {
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease-in-out;
    font-weight: bold;
}

.animated-btn:after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.4);
    transition: opacity 0.3s ease-in-out;
    opacity: 0;
    z-index: 1;
}

.animated-btn:hover:after {
    opacity: 1;
}

.animated-btn {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    color: white;
    padding: 5px 10px;
    font-size: 10px;
    border-radius: 5px;
    text-transform: uppercase;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.date{
    font-size: 12px; 
    width: auto;"
}

 /* Modal Container */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 9999;
  overflow: auto;
  animation: fadeIn 0.5s ease-in-out;
}

/* Modal Content */
.modal-content {
  background: none !important;
  margin: 5% auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 700px;
  position: relative;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
  animation: slideIn 0.5s ease-in-out;
}

/* Close Button */
.close-button {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #ff4d4d;
  cursor: pointer;
  transition: color 0.3s;
}

.close-button:hover {
  color: #ff1a1a;
}

/* Modal Content Styling */
#modalContent {
  color: #333;
  font-family: Arial, sans-serif;
}

h3 {
  color: #333;
  margin-bottom: 20px;
}

/* Modal Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideIn {
  from { transform: translateY(-30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

       .card {
    padding-top: 10px;
    display: flex;
     background: #232f65 url('/img/jk.png'); /
    border-radius: 10px;
    overflow: hidden;
 box-shadow: rgba(0, 0, 0, 0.19) 0px 10px 20px, rgba(0, 0, 0, 0.23) 0px 6px 6px;
    background-size: cover; /* Ensure background images cover the card */
    background-blend-mode: overlay;
    width: 600px;
    transition: transform 0.3s;
}

        .card:hover {
            transform: scale(1.03);
        }
/* Base styles for cards */
.bg-light {
    background-color: #f8f9fa;
}

.rounded {
    border-radius: .375rem;
}

.d-flex {
    display: flex;
}

.align-items-center {
    align-items: center;
}

.justify-content-between {
    justify-content: space-between;
}


/* Responsive styles */
@media (max-width: 768px) {
    .col-sm-6 {
        flex: 0 0 50%;
        max-width: 50%;
    }
}

        .photo-container {
            width: 150px;
            background: white;
            display: flex;
            justify-content: center;
            margin-top: -170px;
            align-items: center;
            border-left: 4px solid #fff;
        }

        .photo-placeholder {
            background-color: #ddd;
            height: 120px;
            width: 120px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px auto;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
        }

        .info {
            padding: 20px;
            color: white;
            flex: 1;
        }

        h2 {
            margin: 0 0 10px;
        }

        p {
            margin: 5px 0;
        }

        .links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .link {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            text-decoration: none;
            flex: 1 1 48%;
            transition: background 0.3s;
            box-sizing: border-box;
        }

        .link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
 .photo-container {
    width: 150px;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    border-left: 4px solid #fff;
}

.photo-placeholder {
    background-color: #ddd;
    height: 120px;
    width: 120px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
}

.edit-icon {
    position: absolute;
    bottom: 0;
    right: 0;
    color: rgb(0, 0, 0);
    border-radius: 50%;
    padding: 5px;
    cursor: pointer;
    font-size: 20px;
    transition: background 0.3s;
}

.edit-icon:hover {
    background: #0056b3;
}
.text-white{
    color: white !important;
}
#profilePhoto {

    border-radius: 50%;
    height: 120px;
    width: 120px;
    object-fit: cover;
}
.info p {
    
    background-image: linear-gradient(147deg, #c3cbdc 0%, #edf1f4 74%); /* White gradient */
    -webkit-background-clip: text; /* Clips the background to the text */
    -webkit-text-fill-color: transparent; /* Makes the text itself transparent */
  
}

.info h2 {
    background-image: linear-gradient(135deg, #ffffff, #e0e0e0); /* White gradient */
    -webkit-background-clip: text; /* Clips the background to the text */
    -webkit-text-fill-color: transparent; /* Makes the text itself transparent */
    background-clip: text; /* Ensures the effect works on all browsers */
    text-fill-color: transparent; /* Ensures the text is filled with the gradient */
/* Adds the margin bottom */
}

        @media (max-width: 768px) {
           .card {
        width: 350px;
        padding: 15px;
        margin: 10px auto; /* Add margin for spacing on mobile screens */
        background-size: contain; /* Make the background image smaller */
        background-position: center; /* Center the background image */
    }

            .photo-container {
                width: 100px !important;
                margin-top: -130px;
            }

            .photo-placeholder {
                height: 80px !important;
                width: 80px !important;
                font-size: 14px;
            }

            .info {
                padding: 10px;
            }

            h2 {
                font-size: 18px;
            }

            p {
                font-size: 12px;
            }
        }
        .container-fluid{
  
    display: flex;
    align-items: center;
    justify-content: center;
        }
       
</style>
</head>

<body>
    <div class="container-xxl position-relative bg-white d-flex p-0" style="background-color: #232f65;">
        <!-- Spinner Start -->
        <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3" style="background-color: #232f65;">
            <nav class="navbar " style="background-color: #232f65;">
                <a href="index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary"> <img src="/images/indian-hub-logo-vert-white-e1662813826792.png" alt="Indian Edu Hub Logo" class="log"></h3>
                </a>
                <div class="d-flex align-items-center ms-4 mb-4" style="background-color: #232f65;">
                      
                    <div class="ms-3" >
                        <h6 class="mb-0 text-white">Indianeduhub</h6>
                        <span style="color: rgb(209, 211, 212);">Client</span>
                    </div>
                </div>
                <div class="navbar-nav w-100" style="background-color: #232f65;">
                    <a href="/accounts-dashboard" class="nav-item nav-link text-white "><i class="fa fa-tachometer-alt me-2 text-dark"></i>Dashboard</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle active" data-bs-toggle="dropdown"><i class="fa fa-laptop me-2"></i>Leads</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/accounts-details" class="dropdown-item active">Leads Details</a>
                       
                        </div>
                    </div>
                     <a href="/create-payments" class="nav-item nav-link text-white "><i class="fa fa-tachometer-alt me-2 text-dark"></i>Create Pay Steps</a>
                 <a href="/accounts-invoice" class="nav-item nav-link text-white "><i class="fa fa-tachometer-alt me-2 text-dark"></i>Invoice</a>
                </div>
            </nav>
        </div>
        <!-- Sidebar End -->


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
                <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><img src="/img/ie.png" alt="Indian Edu Hub Logo" style="height: 30px;"></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>
                <form class="d-none d-md-flex ms-4">
                    <input class="form-control border-0" type="search" placeholder="Search">
                </form>
                <div class="navbar-nav align-items-center ms-auto">
                    
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notificatin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Profile updated</h6>
                                <small>15 minutes ago</small>
                            </a>
                       
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all notifications</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="rounded-circle me-lg-2" src="/images/anon.webp" alt="" style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">Client</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">Log Out</a>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Navbar End -->


<div class="container tt mt-5 px-2">
<button id="saveChangesBtn" class="btn btn-primary">Save Changes</button>
        <button id="hideFieldsButton" class="button-57  mx-2" role="button">    <span class="text">Show hidden fields</span>
                <span>Hide</span></button>
    <div class="table-responsive">
        <table class="table table-responsive table-borderless" id="dataTable">
            {{!-- <button id="saveButton" class="button-57" role="button">
                <span class="text">Save Changes</span>
                <span>Save</span>  </button> --}}
            
          
            <thead>
                <tr class="bg-light">
                    <th hidden>id</th>
                    <th>No.</th>
                    <th>Doc Date</th>
                    <th>Date</th>
                    <th>Student ID</th>
                    <th>Student Name</th>
                    <th>Course</th>
                    <th class="toggle-column">Email</th>
                    <th class="toggle-column">Mobile Number</th>
                    <th class="toggle-column">State</th>
                    <th class="toggle-column">Counselor Name</th>
                    <th >Service Pack</th>
                    <th class="toggle-column">Intake</th>
                    
                    <th class="toggle-column">Initial Reg</th>
                    <th class="toggle-column">Initial Reg Date</th>
                    <th class="toggle-column">Uni Paid</th>
                    <th >Uni Fee Paid Date</th>
                    <th class="toggle-column">Document Status</th>
                    <th class="toggle-column">Uni Refund Initiated</th>
                    <th class="toggle-column">Date of Uni Refund Initiated</th>
                    <th class="toggle-column">IEH Refund Initiated</th>
                    <th class="toggle-column">Date of IEH Refund Initiated</th>
                    <th class="toggle-column">Scholarship</th>
                    <th >Mode</th>
                    <th >Amount</th>
                    <th class="toggle-column">Semester Status</th>
                    <th class="toggle-column">Batch</th>
                    <th class="toggle-column">Enrollment No</th>
                    <th>Degree Type</th>
                    <th>University</th>
                    <th>TEA</th>
                    <th>Study Status</th>
                         <th>Payment Step 1</th> <!-- New header -->
    <th>Details for Step 1</th> <!-- New header -->
    <th>Payment Step 2</th> <!-- New header -->
    <th>Details for Step 2</th> <!-- New header -->
    <th>Payment Step 3</th> <!-- New header -->
    <th>Details for Step 3</th> <!-- New header -->
    <th>Final Status</th>
    <th>TGA</th>
    <th>Referral Wallet</th>
    <th>Partner Wallet</th>
    <th>Own Wallet</th>
    {{!-- <th>Action</th> --}}
                </tr>
            </thead>
            <tbody>
                {{#each formData}}
               <tr data-id="{{this._id}}">
        <td hidden>{{this._id}}</td> <!-- The ID is stored in a hidden cell for reference -->
                    <td>{{incrementIndex @index}}</td>
                    <td class="text-danger font-weight-bold">{{this.docApprovedDate}}</td>
                    <td class="text-danger font-weight-bold">{{this.date}}</td>
                    <td class="text-dark font-weight-bold">{{this.studentid}}</td>
                    <td>{{this.name}}</td>
                    <td >{{this.course}}</td>
                    <td class="hideable">{{this.email}}</td>
                    <td class="hideable">{{this.mobile}}</td>
                    <td class="hideable" >{{this.state}}</td>
                    <td class="hideable">{{this.specificName}}</td>
                    <td >{{this.servicePack}}</td>
                    <td class="hideable">{{this.intake}}</td>
                   
                    <td class="hideable">{{this.initialRegistration}}</td>
                    <td class="hideable">{{this.initialDate}}</td>
                    <td class="hideable">
                        <button class="btn btn-status btn-paid">{{this.universityPaid}}</button>
                    </td>
                    <td >{{this.universityPaidDate}}</td>
                    <td class="hideable">
                        <button class="btn btn-status btn-approved">{{this.documentStatus}}</button>
                    </td>
                    <td class="hideable detail-row">
                        {{#if this.unirefundinitiated}}
                        {{this.unirefundinitiated}}
                        {{else}}
                        N/A
                        {{/if}}
                    </td>
                    <td class="hideable refund-cell detail-row">
                        {{#if this.unirefundinitiated}}
                        {{this.unirefundinitiated}}
                        {{else}}
                        N/A
                        {{/if}}
                    </td>
                    <td class="hideable detail-row">
                        {{#if this.iehrefundinitiated}}
                        {{this.iehrefundinitiated}}
                        {{else}}
                        N/A
                        {{/if}}
                    </td>
                    <td class="hideable refund-cell detail-row">
                        {{#if this.iehrefundinitiated}}
                        {{this.iehrefundinitiated}}
                        {{else}}
                        N/A
                        {{/if}}
                    </td>
                    <td class="hideable">{{this.scholarship}}</td>
                    <td >{{this.feepaid}}</td>
                    <td >{{this.feePaidAmount}}</td>
                    <td class="hideable">{{this.semesterStatus}}</td>
                    <td class="hideable">{{this.batch}}</td>
                    <td class="hideable">{{this.enrollmentNo}}</td>
                                       <td>
        <select class="form-select">
            <option value="" {{#if (eq this.degreeType "")}}selected{{/if}}>Select Degree</option>
            <option value="UG" {{#if (eq this.degreeType "UG")}}selected{{/if}}>UG</option>
            <option value="PG" {{#if (eq this.degreeType "PG")}}selected{{/if}}>PG</option>
        </select>
    </td>
         <td>
  {{#if (eq this.university "Manipal Jaipur University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=Soubin.sukumaran@onlinemanipal.com" target="_blank">Manipal Jaipur University</a>
  {{else if (eq this.university "Manipal Sikkim University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=Soubin.sukumaran@onlinemanipal.com" target="_blank">Manipal Sikkim University</a>
  {{else if (eq this.university "Jain Online University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=adarsh.kh@usdcglobal.com" target="_blank">Jain Online University</a>
  {{else if (eq this.university "Jain ODL University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=Syed.imran@teamlease.com" target="_blank">Jain ODL University</a>
  {{else if (eq this.university "Vignan University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=adarsh.kh@usdcglobal.com" target="_blank">Vignan University</a>
  {{else if (eq this.university "Amity University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=billing@univoedtech.com" target="_blank">Amity University</a>
  {{else if (eq this.university "SVSU")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">SVSU</a>
  {{else if (eq this.university "Aligarh Muslim University Online")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">Aligarh Muslim University Online</a>
  {{else if (eq this.university "KLU Online")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">KLU Online</a>
  {{else if (eq this.university "Mizoram University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">Mizoram University</a>
  {{else if (eq this.university "Jamia Hamdard University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">Jamia Hamdard University</a>
  {{else if (eq this.university "Uttaranchal University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">Uttaranchal University</a>
  {{else if (eq this.university "Andhra University")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=syed.imran@teamlease.com" target="_blank">Andhra University</a>
  {{else if (eq this.university "LPU")}}
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=connectprashantraghuvanshi@gmail.com" target="_blank">LPU</a>
  {{else}}
    {{this.university}}
  {{/if}}
</td>
<td>
  <input 
    type="number" 
    id="totalExpectedAMt" 
    class="form-control me-2 amts" 
    placeholder="{{#if (eq this.totalExpectedAMt "")}}Enter Expected Amount{{else}}Expected Amount{{/if}}" 
    value="{{this.totalExpectedAMt}}" 
  />
  <div class="d-flex align-items-center mt-2">
    <input 
      type="date" 
      id="totalExpectedAMtDate" 
      class="form-control me-2 date" 
      placeholder="{{#if (eq this.totalExpectedAMtDate "")}}Select Expected Date{{else}}Expected Date{{/if}}" 
      value="{{this.totalExpectedAMtDate}}" 
    />
  </div>
</td>

             <td>
  <select id="studyStage" class="form-select mb-2 date" name="studyStage">
      <option value="" disabled {{#if (eq this.studyStage "")}}selected{{/if}}>Select Sem</option>
      <option value="sem1" {{#if (eq this.studyStage "sem1")}}selected{{/if}}>Sem 1</option>
      <option value="sem2" {{#if (eq this.studyStage "sem2")}}selected{{/if}}>Sem 2</option>
      <option value="sem3" {{#if (eq this.studyStage "sem3")}}selected{{/if}}>Sem 3</option>
      <option value="sem4" {{#if (eq this.studyStage "sem4")}}selected{{/if}}>Sem 4</option>
      <option value="sem5" {{#if (eq this.studyStage "sem5")}}selected{{/if}}>Sem 5</option>
      <option value="sem6" {{#if (eq this.studyStage "sem6")}}selected{{/if}}>Sem 6</option>
      <option value="1st_year" {{#if (eq this.studyStage "1st_year")}}selected{{/if}}>1st Year</option>
      <option value="2nd_year" {{#if (eq this.studyStage "2nd_year")}}selected{{/if}}>2nd Year</option>
      <option value="3rd_year" {{#if (eq this.studyStage "3rd_year")}}selected{{/if}}>3rd Year</option>
      <option value="Full Fee" {{#if (eq this.studyStage "Full Fee")}}selected{{/if}}>Full Fee</option>
  </select>
</td>



           <!-- Payment Step 1 -->
<td>
  <select id="paymentStep1Dropdown" class="form-select date">
    <option disabled selected>Select One</option>
    {{#each ../payments.[0].payments.[0].fields}}
      <option value="{{this}}">{{this}}</option>
    {{else}}
      <option>No Data</option>
    {{/each}}
  </select>
</td>


<td>
  <textarea id="paymentStep1Details" class="form-control" placeholder="Enter details..."></textarea>
  <div class="d-flex align-items-center mt-2">
    <input type="number" id="paymentStep1Amount" class="form-control me-2 amt" placeholder="Amount" />
    <input type="date" id="paymentStep1Date" class="form-control me-2 date" />
    <a href="your-drive-link" target="_blank" class="upload-icon">
      <i class="fas fa-upload"></i>
    </a>
  </div>
</td>

<!-- Payment Step 2 -->
<td>
  <select id="paymentStep2Dropdown" class="form-select date">
    <option disabled selected>Select One</option>
    {{#each ../payments.[0].payments.[1].fields}}
    <option value="{{this}}">{{this}}</option>
    {{else}}
    <option>No Data</option>
    {{/each}}
  </select>
</td>

<td>
  <textarea id="paymentStep2Details" class="form-control" placeholder="Enter details..."></textarea>
  <div class="d-flex align-items-center mt-2">
    <input type="number" id="paymentStep2Amount" class="form-control me-2 amt" placeholder="Amount" />
    <input type="date" id="paymentStep2Date" class="form-control me-2 date" />
    <a href="your-drive-link" target="_blank" class="upload-icon">
      <i class="fas fa-upload"></i>
    </a>
  </div>
</td>

<!-- Payment Step 3 -->
<td>
  <select id="paymentStep3Dropdown" class="form-select date">
    <option disabled selected>Select One</option>
    {{#each ../payments.[0].payments.[2].fields}}
    <option value="{{this}}">{{this}}</option>
    {{else}}
    <option>No Data</option>
    {{/each}}
  </select>
</td>

<td>
  <textarea id="paymentStep3Details" class="form-control" placeholder="Enter details..."></textarea>
  <div class="d-flex align-items-center mt-2">
    <input type="number" id="paymentStep3Amount" class="form-control me-2 amt" placeholder="Amount" />
    <input type="date" id="paymentStep3Date" class="form-control me-2 date" />
    <a href="your-drive-link" target="_blank" class="upload-icon">
      <i class="fas fa-upload"></i>
    </a>
  </div>
</td>


     <!-- Semester Status Dropdown -->
            <td>
  <select id="semesterStatus" class="form-select date">
    <option value="" {{#if (eq this.finalStatus "")}}selected{{/if}}>Select Status</option>
    <option value="Waiting for Sem 2" {{#if (eq this.finalStatus "Waiting for Sem 2")}}selected{{/if}}>Waiting for Sem 2</option>
    <option value="Waiting for Sem 3" {{#if (eq this.finalStatus "Waiting for Sem 3")}}selected{{/if}}>Waiting for Sem 3</option>
    <option value="Waiting for Sem 4" {{#if (eq this.finalStatus "Waiting for Sem 4")}}selected{{/if}}>Waiting for Sem 4</option>
    <option value="Waiting for Sem 5" {{#if (eq this.finalStatus "Waiting for Sem 5")}}selected{{/if}}>Waiting for Sem 5</option>
    <option value="Waiting for Sem 6" {{#if (eq this.finalStatus "Waiting for Sem 6")}}selected{{/if}}>Waiting for Sem 6</option>
    <option value="Completed" {{#if (eq this.finalStatus "Completed")}}selected{{/if}} class="text-success">Completed</option>
    <option value="Dropout" {{#if (eq this.finalStatus "Dropout")}}selected{{/if}} class="text-danger">Dropout</option>
    <option value="Waiting for 2nd Year" {{#if (eq this.finalStatus "Waiting for 2nd Year")}}selected{{/if}}>Waiting for 2nd Year</option>
    <option value="Waiting for 3rd Year" {{#if (eq this.finalStatus "Waiting for 3rd Year")}}selected{{/if}}>Waiting for 3rd Year</option>
  </select>
</td>
<td>
  <input 
    type="number" 
    id="totalAMt" 
    class="form-control me-2 amts" 
    placeholder="{{#if (eq this.totalAMt "")}}Enter Amount{{else}}Amount{{/if}}" 
    value="{{this.totalAMt}}" 
  />
  <div class="d-flex align-items-center mt-2">
    <input 
      type="date" 
      id="totalAMtDate" 
      class="form-control me-2 date" 
      placeholder="{{#if (eq this.totalAMtDate "")}}Select Date{{else}}Date{{/if}}" 
      value="{{this.totalAMtDate}}" 
    />
  </div>
</td>


            <td class="text-success font-weight-bold" onclick="findInstitute('{{this.referredBy}}', {
      studentid: '{{this.studentid}}',
      name: '{{this.name}}',
      course: '{{this.course}}',
      email: '{{this.email}}',
      mobile: '{{this.mobile}}',
      state: '{{this.state}}',
      date: '{{this.date}}',
      amount:'{{feePaidAmount}}'
    })">
      {{this.referredBy}}
    </td>
       <td>
            <select class="form-control amt" id="instituteSelect-{{this.id}}"
              data-studentid="{{this.studentid}}"
              data-name="{{this.name}}"
              data-course="{{this.course}}"
              data-email="{{this.email}}"
              data-mobile="{{this.mobile}}"
              data-state="{{this.state}}"
              data-date="{{this.date}}"
              data-amount="{{feePaidAmount}}"
              onchange="fetchInstituteDetails(this)">
              <option value="">Select Institute</option>
              {{#each ../combinedPartners}}
                <option value="{{this.instituteid}}">
                  {{this.institutename}} ({{this.instituteid}})
                </option>
              {{/each}}
            </select>
          </td>
      <td>
  <select class="form-control amt" id="dropdown-{{this.id}}"
    data-studentid="{{this.studentid}}"
    data-name="{{this.name}}"
    data-course="{{this.course}}"
    data-email="{{this.email}}"
    data-mobile="{{this.mobile}}"
    data-state="{{this.state}}"
    data-date="{{this.date}}"
    data-amount="{{feePaidAmount}}"
    onchange="fetchInstituteDetailss(this)">
    <option value="">Select</option>
    <option value="IEHD" class="text-success font-weight-bold">IEHD</option>
    <option value="IEHP" class="text-dark font-weight-bold">IEHP</option>
  </select>
</td>

   {{!-- <td>
            <button class="btn btn-primary saveChangesBtn">Save Changes</button>
        </td> --}}

                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>


<!-- Modal Container -->
<div id="instituteModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal()">&times;</span>
    <div id="modalContent" class="container-fluid pt-4 px-4">
      <!-- The card will be dynamically injected here by JavaScript -->
    </div>
  </div>
</div>
<script>
function fetchInstituteDetailss(selectElement) {
  const instituteId = selectElement.value;
  const studentDetails = {
    studentid: selectElement.dataset.studentid,
    name: selectElement.dataset.name,
    course: selectElement.dataset.course,
    email: selectElement.dataset.email,
    mobile: selectElement.dataset.mobile,
    state: selectElement.dataset.state,
    date: selectElement.dataset.date,
    amount: selectElement.dataset.amount
  };

  if (instituteId) {
    fetch(`/find-supers/${instituteId}`)
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          alert(data.message); // Handle case when no institute is found
        } else {
          // Display the details in the modal
          displayInstituteDetailss(data, studentDetails, instituteId);
        }
      })
      .catch(error => {
        console.error('Error fetching institute details:', error);
      });
  }
}



function displayInstituteDetailss(institute, student, instituteId) {
  const walletField = instituteId === 'IEHD' ? 'wallet' : 'walletP';
  const totalWalletAmount = instituteId === 'IEHD' ? institute.totalWalletAmount : 0;
  const totalWalletAmountP = instituteId === 'IEHP' ? institute.totalWalletAmountP : 0;
  
  const instituteIdDisplay = instituteId === 'IEHD' ? institute.instituteid : institute.instituteidP;

  const details = `
    <div class="container-fluid pt-4 px-4">
      <div class="row g-4">
        <div class="card">
          <div class="info">
            <h2 class="mb-3">${institute.name}</h2>
            <p><strong>Owner Name:</strong> ${institute.owner_name || ''}</p>
            <p><strong>Email:</strong> ${institute.email}</p>
            <p><strong>Institute Place:</strong> ${institute.state || ''}, ${institute.city || ''}</p>
            <p class="text-white"><strong>Institute ID:</strong> <b class="text-white">${instituteIdDisplay}</b> </p>
            <b class="text-warning"><strong>Student ID:</strong> ${student.studentid}, Amount: ${student.amount}</b>
            <div class="photo-container ms-auto" style="border-radius: 10px;">
              <img id="profilePhoto" src="${institute.profilePhoto || '/images/anon.webp'}" class="photo-placeholder" alt="Profile Photo" />
              <div class="edit-icon" onclick="document.getElementById('fileInput').click();">
                <i class="fa fa-edit"></i>
              </div>
            </div>
            <div class="links mt-5 mb-3">
              <form id="sendMoneyForm">
                <div class="form-group mb-3">
                  <label for="amount">Send Wallet Money:</label>
                  <input type="number" id="amount" class="form-control" placeholder="Enter amount" required />
                </div>
                <button type="submit" class="btn btn-primary">Send</button>
              </form>
            </div>
            <div class="total-wallet mt-3 float-end text-white">
              ${instituteId === 'IEHD' ? `
                <h6 style="margin-top: -130px; color: #c3cbdc;"><strong>Wallet Amount (IEHD):</strong></h6>
                <center><h4 class="text-white"><span id="totalWalletAmount">${totalWalletAmount}</span></h4></center>
              ` : ''}
              ${instituteId === 'IEHP' ? `
                <h6 style="margin-top: -130px; color: #c3cbdc;"><strong>Wallet Amount (IEHP):</strong></h6>
                <center><h4 class="text-white"><span id="totalWalletAmountP">${totalWalletAmountP}</span></h4></center>
              ` : ''}
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modalContent').innerHTML = details;
  document.getElementById('instituteModal').style.display = 'block';

  document.getElementById('sendMoneyForm').addEventListener('submit', function (event) {
    event.preventDefault();
    const amount = document.getElementById('amount').value;
    handleSendMoneyss(instituteId, amount, student);
  });
}



function handleSendMoneyss(instituteId, amount, student) {
  fetch(`/add-to-wallet-super/${instituteId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ amount, student })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('Money added successfully!');

      // Update total wallet amounts in the modal
      if (instituteId === 'IEHD') {
        document.getElementById('totalWalletAmount').textContent = data.totalWalletAmount || 0;
      } else if (instituteId === 'IEHP') {
        document.getElementById('totalWalletAmountP').textContent = data.totalWalletAmountP || 0;
      }
    } else {
      alert('Failed to add money: ' + data.message);
    }
  })
  .catch(error => {
    console.error('Error adding money:', error);
  });
}


  function closeModal() {
    document.getElementById('instituteModal').style.display = 'none';
  }
</script>


    <script>
    function fetchInstituteDetails(selectElement) {
      const instituteId = selectElement.value;
      const studentDetails = {
        studentid: selectElement.dataset.studentid,
        name: selectElement.dataset.name,
        course: selectElement.dataset.course,
        email: selectElement.dataset.email,
        mobile: selectElement.dataset.mobile,
        state: selectElement.dataset.state,
        date: selectElement.dataset.date,
        amount: selectElement.dataset.amount
      };

      if (instituteId) {
        fetch(`/find-institute/${instituteId}`)
          .then(response => response.json())
          .then(data => {
            if (data.message) {
              alert(data.message); // Handle case when no institute is found
            } else {
              // Display the details in the modal
              displayInstituteDetails(data, studentDetails);
            }
          })
          .catch(error => {
            console.error('Error fetching institute details:', error);
          });
      }
    }

    function displayInstituteDetails(institute, student) {
      const details = `
        <div class="row g-4">
          <div class="card">
            <div class="info">
              <h2 class="mb-3">${institute.institutename}</h2>
              <p><strong>Owner Name:</strong> ${institute.owner_name}</p>
              <p><strong>Email:</strong> ${institute.email}</p>
              <p><strong>Institute Place:</strong> ${institute.state}, ${institute.city}</p>
              <p><strong>Institute ID:</strong> ${institute.instituteid}</p>
              <b class="text-warning"><strong>Student ID:</strong> ${student.studentid}, Amount: ${student.amount}</b>
              <div class="photo-container ms-auto" style="border-radius: 10px;">
                <img id="profilePhoto" src="${institute.profilePhoto || '/images/anon.webp'}" class="photo-placeholder" alt="Profile Photo" />
                <div class="edit-icon" onclick="document.getElementById('fileInput').click();">
                  <i class="fa fa-edit"></i>
                </div>
              </div>
              <div class="links mt-5 mb-3">
                <form id="sendMoneyForm">
                 <div class="form-group mb-3">
  <label for="amount">Send Wallet Money:</label>
  <input type="number" id="amount" class="form-control" placeholder="Enter amount" required />
  <div class="invalid-feedback"> <!-- Placeholder for error messages -->
    <!-- Error message will be dynamically inserted here -->
  </div>
</div>

                  <button type="submit" class="btn btn-primary">Send</button>
                </form>
              </div>
              <div class="total-wallet mt-3 float-end text-white">
                <h5 style="margin-top: -130px; color: #c3cbdc;"><strong>Wallet Amount:</strong></h5>
                <center><h4 class="text-white"><span id="totalWalletAmount">${institute.totalWalletAmount || 0}</span></h4></center>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('modalContent').innerHTML = details;
      document.getElementById('instituteModal').style.display = 'block';

      document.getElementById('sendMoneyForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const amount = document.getElementById('amount').value;
        handleSendMoney(institute.instituteid, amount, student);
      });
    }

  function handleSendMoney(instituteId, amount, student) {
  const institutePrefix = instituteId.substring(0, 4); // Get the first four characters

  let maxPercentage = 0;

  // Check if the institute ID starts with 'IEHP'
  if (institutePrefix === 'IEHP') {
    maxPercentage = 15;
  } else if (instituteId.startsWith('IEHAP')) {
    maxPercentage = 5;
  } else if (instituteId.startsWith('IEHA')) {
    maxPercentage = 10;
  } else if (instituteId.startsWith('IEH')) {
    maxPercentage = 5;
  } else {
    showError(`Invalid institute ID prefix. Institute ID: ${instituteId}`);
    return;
  }

  const maxAmount = (student.amount * maxPercentage) / 100;

  // Validate that the entered amount is within the allowed range
  if (amount > maxAmount) {
    showError(`The maximum amount you can send is ${maxAmount} (${maxPercentage}% of ${student.amount}).`);
    return;
  }

  // Proceed with sending the money if validation passes
  fetch(`/add-to-wallet/${instituteId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ amount, student })
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Money added successfully!');
        const totalWalletElement = document.getElementById('totalWalletAmount');
        const newTotal = parseFloat(totalWalletElement.textContent) + parseFloat(amount);
        totalWalletElement.textContent = newTotal;
      } else {
        alert('Failed to add money: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error adding money:', error);
    });
}

function showError(message) {
  const amountInput = document.getElementById('amount');
  amountInput.classList.add('is-invalid'); // Highlight input box in red
  const errorElement = document.createElement('div');
  errorElement.classList.add('invalid-feedback');
  errorElement.innerText = message;
  amountInput.parentElement.appendChild(errorElement); // Display error message below input
}


    function closeModal() {
      document.getElementById('instituteModal').style.display = 'none';
    }
  </script>
<script>
  

function findInstitute(referredBy, student) { // Pass the student details as an additional parameter
  fetch(`/find-institute/${referredBy}`)
    .then(response => response.json())
    .then(data => {
      if (data.message) {
        alert(data.message); // Handle case when no institute is found
      } else {
        // Display the details in the modal
        displayInstituteDetails(data, student); // Pass the student details to displayInstituteDetails
      }
    })
    .catch(error => {
      console.error('Error fetching institute details:', error);
    });
}

function displayInstituteDetails(institute, student) {
  const details = `
    <div class="row g-4">
      <div class="card">
        <div class="info">
          <h2 class="mb-3">${institute.institutename}</h2>
          <p><strong>Owner Name:</strong> ${institute.owner_name}</p>
          <p><strong>Email:</strong> ${institute.email}</p>
          <p><strong>Institute Place:</strong> ${institute.state}, ${institute.city}</p>
          <p><strong>Institute ID:</strong> ${institute.instituteid}</p>
   <b class="text-warning"><strong>Student ID:</strong> ${student.studentid}, Amount:${student.amount}</b>
          <div class="photo-container ms-auto" style="border-radius: 10px;">
            <img id="profilePhoto" src="${institute.profilePhoto || '/images/anon.webp'}" class="photo-placeholder" alt="Profile Photo" />
            <div class="edit-icon" onclick="document.getElementById('fileInput').click();">
              <i class="fa fa-edit"></i>
            </div>
          </div>

          <div class="links mt-5 mb-3">
            <form id="sendMoneyForm">
         <div class="form-group mb-3">
  <label for="amount">Send Wallet Money:</label>
  <input type="number" id="amount" class="form-control" placeholder="Enter amount" required />
  <div class="invalid-feedback"> <!-- Placeholder for error messages -->
    <!-- Error message will be dynamically inserted here -->
  </div>
</div>

              <button type="submit" class="btn btn-primary">Send</button>
            </form>
          </div>

     <div class="total-wallet mt-3 float-end text-white">

<h5  style="margin-top: -130px; color: #c3cbdc;"><strong>Wallet Amount:</strong></h5>
  
<center>  <h4 class="text-white"><span id="totalWalletAmount">${institute.totalWalletAmount || 0}</span></h4></center>
</div>


        </div>
      </div>
    </div>
  `;
  document.getElementById('modalContent').innerHTML = details;
  document.getElementById('instituteModal').style.display = 'block';

  document.getElementById('sendMoneyForm').addEventListener('submit', function (event) {
    event.preventDefault();
    const amount = document.getElementById('amount').value;
    handleSendMoney(institute.instituteid, amount, student);
  });
}


function handleSendMoney(instituteId, amount, student) {
  const institutePrefix = instituteId.substring(0, 4); // Get the first four characters

  let maxPercentage = 0;

  // Check if the institute ID starts with 'IEHP'
  if (institutePrefix === 'IEHP') {
    maxPercentage = 15;
  } else if (instituteId.startsWith('IEHAP')) {
    maxPercentage = 5;
  } else if (instituteId.startsWith('IEHA')) {
    maxPercentage = 10;
  } else if (instituteId.startsWith('IEH')) {
    maxPercentage = 5;
  } else {
    showError(`Invalid institute ID prefix. Institute ID: ${instituteId}`);
    return;
  }

  const maxAmount = (student.amount * maxPercentage) / 100;

  // Validate that the entered amount is within the allowed range
  if (amount > maxAmount) {
    showError(`The maximum amount you can send is ${maxAmount} (${maxPercentage}% of ${student.amount}).`);
    return;
  }

  // Proceed with sending the money if validation passes
  fetch(`/add-to-wallet/${instituteId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ amount, student })
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Money added successfully!');
        const totalWalletElement = document.getElementById('totalWalletAmount');
        const newTotal = parseFloat(totalWalletElement.textContent) + parseFloat(amount);
        totalWalletElement.textContent = newTotal;
      } else {
        alert('Failed to add money: ' + data.message);
      }
    })
    .catch(error => {
      console.error('Error adding money:', error);
    });
}

function showError(message) {
  const amountInput = document.getElementById('amount');
  amountInput.classList.add('is-invalid'); // Highlight input box in red
  const errorElement = document.createElement('div');
  errorElement.classList.add('invalid-feedback');
  errorElement.innerText = message;
  amountInput.parentElement.appendChild(errorElement); // Display error message below input
}



function closeModal() {
  document.getElementById('instituteModal').style.display = 'none';
}
</script>

        <script>
 $('#dataTable').DataTable({
    layout: {
        topStart: {
            buttons: [
                'copy',
                'csv',
                'excel',
                'pdf',
                {
                    extend: 'print',
                    text: 'Print all (not just selected)',
                    exportOptions: {
                        modifier: {
                            selected: null
                        }
                    }
                }
            ]
        }
    },
    select: true
});


</script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#hideFieldsButton').on('click', function() {
            const columnsToToggle = $('.toggle-column, .hideable');
            const isHidden = columnsToToggle.first().is(':hidden');

            // Faster speed: 200ms for animation and delay
            const speed = 10;
            
            if (isHidden) {
                // Show columns with animation
                columnsToToggle.each(function(index) {
                    $(this).delay(index * speed).slideDown(speed);
                });
                $(this).text('Hide Fields');
            } else {
                // Hide columns with animation
                columnsToToggle.each(function(index) {
                    $(this).delay(index * speed).slideUp(speed);
                });
                $(this).text('Show Fields');
            }
        });

        // Initially hide the columns
        $('.toggle-column, .hideable').hide();
    });
</script>

<script>
  $(document).on('change', '#studyStage', function () {
    const $row = $(this).closest('tr'); // Get the closest row
    const studyStage = $(this).val();
    const clientId = $row.data('id'); // Get the client ID from the row's data-id attribute

    // Log the clientId to ensure it's correctly retrieved
    console.log("Client ID:", clientId);
    
    if (studyStage && clientId) {
      $.ajax({
        url: `/get-payment-details/${clientId}/${studyStage}`,
        method: 'GET',
        success: function (response) {
          if (response.success) {
            const paymentDetails = response.paymentDetails;

            // Update the payment steps fields with fetched data
            $row.find('#paymentStep1Dropdown').val(paymentDetails[0]?.selectedValue || '');
            $row.find('#paymentStep1Details').val(paymentDetails[0]?.details || '');
            $row.find('#paymentStep1Amount').val(paymentDetails[0]?.amount || '');
            $row.find('#paymentStep1Date').val(paymentDetails[0]?.date || '');

            $row.find('#paymentStep2Dropdown').val(paymentDetails[1]?.selectedValue || '');
            $row.find('#paymentStep2Details').val(paymentDetails[1]?.details || '');
            $row.find('#paymentStep2Amount').val(paymentDetails[1]?.amount || '');
            $row.find('#paymentStep2Date').val(paymentDetails[1]?.date || '');

            $row.find('#paymentStep3Dropdown').val(paymentDetails[2]?.selectedValue || '');
            $row.find('#paymentStep3Details').val(paymentDetails[2]?.details || '');
            $row.find('#paymentStep3Amount').val(paymentDetails[2]?.amount || '');
            $row.find('#paymentStep3Date').val(paymentDetails[2]?.date || '');
          } else {
            console.warn('No payment details found for this study stage.');
          }
        },
        error: function (err) {
          console.error('Error fetching payment details:', err);
        }
      });
    } else {
      console.error("Client ID or study stage is missing.");
    }
  });

</script>

<!-- Include SweetAlert2 for alerts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).on('click', '#saveChangesBtn', function(e) {
    e.preventDefault(); // Prevent default form submission

    let updatedData = [];

    // Iterate over each row
    $('#dataTable tbody tr').each(function() {
        let $row = $(this);

        // Retrieve the account ID from data-id attribute
        let accountId = $row.data('id');
        if (!accountId) {
            console.error('Account ID is missing for this row:', $row);
            return;
        }

        // Retrieve the selected study stage
        let studyStage = $row.find('#studyStage').val();
        if (!studyStage) {
            console.warn('Study Stage is not selected for this row.');
            return;
        }

        // Collect payment step details for the current row
        let paymentDetails = [
            {
                step: 'paymentStep1',
                selectedValue: $row.find('#paymentStep1Dropdown').val(),
                details: $row.find('#paymentStep1Details').val(),
                amount: $row.find('#paymentStep1Amount').val(),
                date: $row.find('#paymentStep1Date').val()
            },
            {
                step: 'paymentStep2',
                selectedValue: $row.find('#paymentStep2Dropdown').val(),
                details: $row.find('#paymentStep2Details').val(),
                amount: $row.find('#paymentStep2Amount').val(),
                date: $row.find('#paymentStep2Date').val()
            },
            {
                step: 'paymentStep3',
                selectedValue: $row.find('#paymentStep3Dropdown').val(),
                details: $row.find('#paymentStep3Details').val(),
                amount: $row.find('#paymentStep3Amount').val(),
                date: $row.find('#paymentStep3Date').val()
            }
        ];

        // Fetch the current row data if it exists, or initialize a new object
        let existingRow = updatedData.find(data => data._id === accountId);
        if (!existingRow) {
            existingRow = {
                _id: accountId,
                studyStatus: $row.find('#studyStatus').val(),
                semesterStatus: $row.find('#semesterStatus').val(),
                totalAMt: $row.find('#totalAMt').val(),
                totalAMtDate: $row.find('#totalAMtDate').val(),
                totalExpectedAMt: $row.find('#totalExpectedAMt').val(),
                totalExpectedAMtDate: $row.find('#totalExpectedAMtDate').val(),
                paymentDetails: {} // Initialize an empty object for payment details
            };
            updatedData.push(existingRow);
        }

        // Merge existing payment details for the selected study stage with the new payment details
        existingRow.paymentDetails[studyStage] = existingRow.paymentDetails[studyStage] || []; // Preserve old stage data if it exists
        existingRow.paymentDetails[studyStage] = paymentDetails; // Store new details for the current study stage
    });

    // Log updatedData array for debugging
    console.log('Updated Data:', updatedData);

    // Send data via AJAX
    $.ajax({
        url: '/update-accounts-details',
        type: 'POST',
        data: JSON.stringify(updatedData), // Send the updated data
        contentType: 'application/json',
        success: function(response) {
            alert('Changes saved successfully!');
        },
        error: function(xhr, status, error) {
            console.error("Error details:", xhr.responseText); // Log full error
            alert('Error: ' + xhr.responseJSON.message);
        }
    });
});

</script>




 
  <!-- Additional JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/chart/chart.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="lib/tempusdominus/js/moment.min.js"></script>
  <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
  <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

  <!-- Template Javascript -->
  <script src="js/main.js"></script>
</body>
</html>